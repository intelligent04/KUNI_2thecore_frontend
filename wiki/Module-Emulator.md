# Module: Emulator (ì—ë®¬ë ˆì´í„°)

> GPS ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ ì°¨ëŸ‰ ì‹œë™ ì œì–´ ì‹œìŠ¤í…œ

---

## ê°œìš”

ì—ë®¬ë ˆì´í„° í˜ì´ì§€ëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì°¨ëŸ‰ì˜ GPS ë°ì´í„°ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê¸° ìœ„í•´ ì°¨ëŸ‰ ì‹œë™(ON/OFF)ì„ ì œì–´í•©ë‹ˆë‹¤.

**ê²½ë¡œ:** `/emulator`
**íŒŒì¼:** [src/app/emulator/page.tsx](../src/app/emulator/page.tsx)
**API ì„œë²„:** `http://3.37.93.107:8081/api`

---

## ìŠ¤í¬ë¦°ìƒ·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [TopBar]  2 the Core                    [AccountMenu]  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [ì°¨ëŸ‰ ê²€ìƒ‰] [ì£¼í–‰ ê¸°ë¡] [ë°ì´í„° ë¶„ì„] [ì—ë®¬ë ˆì´í„°]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” ì°¨ëŸ‰ë²ˆí˜¸ ê²€ìƒ‰                        [ê²€ìƒ‰]      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                         â”‚
â”‚               ì „ì²´ ì œì–´  [====â—‹] ì „ì²´ OFF               â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ì°¨ëŸ‰ë²ˆí˜¸     â”‚    ìƒíƒœ    â”‚     ON/OFF            â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  12ê°€ 1234   â”‚    ìš´í–‰    â”‚  [====â—] ON           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  23ë‚˜ 2345   â”‚    ëŒ€ê¸°    â”‚  [â—====] OFF          â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  34ë‹¤ 3456   â”‚    ìš´í–‰    â”‚  [====â—] ON           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```mermaid
graph TD
    EmulatorPage["EmulatorPage"]

    EmulatorPage --> NumberSearchBox
    EmulatorPage --> ToggleAll["ì „ì²´ ì œì–´ Switch"]
    EmulatorPage --> Table

    Table --> TableRow["TableRow x N"]
    TableRow --> Switch["Switch (ON/OFF)"]
```

---

## ì£¼ìš” ê¸°ëŠ¥

### 1. ì°¨ëŸ‰ ëª©ë¡ í‘œì‹œ

ëª¨ë“  ì°¨ëŸ‰ ëª©ë¡ì„ í…Œì´ë¸”ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ | ì„¤ëª… |
|------|------|
| ì°¨ëŸ‰ë²ˆí˜¸ | ì°¨ëŸ‰ ì‹ë³„ ë²ˆí˜¸ |
| ìƒíƒœ | ìš´í–‰/ëŒ€ê¸°/ìˆ˜ë¦¬ |
| ON/OFF | ì‹œë™ ìŠ¤ìœ„ì¹˜ |

### 2. ê°œë³„ ì°¨ëŸ‰ ì‹œë™ ì œì–´

ê° ì°¨ëŸ‰ì˜ ìŠ¤ìœ„ì¹˜ë¥¼ í† ê¸€í•˜ì—¬ ì‹œë™ì„ ON/OFFí•©ë‹ˆë‹¤.

- **ON**: ìƒíƒœê°€ 'ìš´í–‰'ìœ¼ë¡œ ë³€ê²½, GPS ë°ì´í„° ìƒì„± ì‹œì‘
- **OFF**: ìƒíƒœê°€ 'ëŒ€ê¸°'ë¡œ ë³€ê²½, GPS ë°ì´í„° ìƒì„± ì¤‘ì§€

### 3. ì „ì²´ ì œì–´

ëª¨ë“  ì°¨ëŸ‰ì˜ ì‹œë™ì„ í•œ ë²ˆì— ON/OFFí•©ë‹ˆë‹¤.

### 4. ì°¨ëŸ‰ ë²ˆí˜¸ ê²€ìƒ‰

íŠ¹ì • ì°¨ëŸ‰ë§Œ í•„í„°ë§í•˜ì—¬ í‘œì‹œí•©ë‹ˆë‹¤.

---

## ìƒíƒœ ê´€ë¦¬

```typescript
// src/app/emulator/page.tsx:17-24
const [cars, setCars] = useState<Car[]>([]);
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
const [carNumber, setCarNumber] = useState('');
const [switchStates, setSwitchStates] = useState<Record<string, boolean>>({});
const [carStatuses, setCarStatuses] = useState<Record<string, string>>({});
```

| ìƒíƒœ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `cars` | `Car[]` | ì°¨ëŸ‰ ëª©ë¡ |
| `switchStates` | `Record<string, boolean>` | ì°¨ëŸ‰ë³„ ìŠ¤ìœ„ì¹˜ ìƒíƒœ |
| `carStatuses` | `Record<string, string>` | ì°¨ëŸ‰ë³„ ìƒíƒœ ë¬¸ìì—´ |

---

## ë°ì´í„° íë¦„

```mermaid
sequenceDiagram
    participant User
    participant EmulatorPage
    participant CarService
    participant EmulService
    participant MainAPI
    participant EmulAPI

    Note over EmulatorPage: í˜ì´ì§€ ë§ˆìš´íŠ¸
    EmulatorPage->>CarService: getAllCars(1, 500)
    CarService->>MainAPI: GET /cars/search
    MainAPI-->>EmulatorPage: ì°¨ëŸ‰ ëª©ë¡
    EmulatorPage->>EmulatorPage: ì´ˆê¸° ìŠ¤ìœ„ì¹˜ ìƒíƒœ ì„¤ì •

    User->>EmulatorPage: ìŠ¤ìœ„ì¹˜ í† ê¸€
    EmulatorPage->>EmulService: powerCar({ carNumber, powerStatus })
    EmulService->>EmulAPI: POST /logs/power
    EmulAPI-->>EmulatorPage: ì„±ê³µ
    EmulatorPage->>EmulatorPage: ìƒíƒœ ì—…ë°ì´íŠ¸
```

---

## API í˜¸ì¶œ

### ì°¨ëŸ‰ ëª©ë¡ ì¡°íšŒ

```typescript
// src/app/emulator/page.tsx:26-46
useEffect(() => {
  const fetchEmulators = async () => {
    const runningCarNumber = await CarService.getAllCars(1, 500);
    setCars(runningCarNumber.content);

    // ì´ˆê¸° ìŠ¤ìœ„ì¹˜ ìƒíƒœ ì„¤ì • (ì°¨ëŸ‰ ìƒíƒœ ê¸°ë°˜)
    const initialStates: Record<string, boolean> = {};
    runningCarNumber.content.forEach(car => {
      initialStates[car.carNumber] = car.status === 'ìš´í–‰';
    });
    setSwitchStates(initialStates);
  };
  fetchEmulators();
}, []);
```

### ì°¨ëŸ‰ ì‹œë™ ì œì–´

```typescript
// src/services/emul-service.ts:23-27
static async powerCar(carData?: Partial<CarDetail>): Promise<CarDetail> {
  const response = await emulatorApi.post('/logs/power', carData);
  return response.data.data;
}
```

**Request Body:**
```json
{
  "carNumber": "12ê°€ 1234",
  "powerStatus": "ON",
  "loginId": "admin"
}
```

---

## ê°œë³„ ì°¨ëŸ‰ ì‹œë™ ì œì–´

```typescript
// src/app/emulator/page.tsx:79-113
const handleSwitchChange = async (carNumber: string, checked: boolean) => {
  // ìŠ¤ìœ„ì¹˜ ìƒíƒœ ë¨¼ì € ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)
  setSwitchStates(prev => ({
    ...prev,
    [carNumber]: checked,
  }));

  const newStatus = checked ? 'ìš´í–‰' : 'ëŒ€ê¸°';

  try {
    await EmulService.powerCar({
      carNumber: carNumber,
      powerStatus: checked ? 'ON' : 'OFF',
      loginId: localStorage.getItem('loginId') || '',
    });

    // ì„±ê³µ ì‹œ cars ë°°ì—´ë„ ì—…ë°ì´íŠ¸
    setCars(prev =>
      prev.map(car =>
        car.carNumber === carNumber
          ? { ...car, status: newStatus, powerStatus: checked ? 'ON' : 'OFF' }
          : car
      )
    );
  } catch (error) {
    // ì—ëŸ¬ ì‹œ ë¡¤ë°±
    setSwitchStates(prev => ({
      ...prev,
      [carNumber]: !checked,
    }));
  }
};
```

---

## ì „ì²´ ì œì–´

```typescript
// src/app/emulator/page.tsx:115-161
const handleToggleAll = async () => {
  const allOn = Object.values(switchStates).every(state => state);
  const newState = !allOn;

  // ëª¨ë“  ìŠ¤ìœ„ì¹˜ ìƒíƒœ ì¼ê´„ ë³€ê²½
  const newStates: Record<string, boolean> = {};
  cars.forEach(car => {
    newStates[car.carNumber] = newState;
  });
  setSwitchStates(newStates);

  try {
    // ëª¨ë“  ì°¨ëŸ‰ì— ëŒ€í•´ ë³‘ë ¬ë¡œ API í˜¸ì¶œ
    const updatePromises = cars.map(car =>
      EmulService.powerCar({
        carNumber: car.carNumber,
        powerStatus: newState ? 'ON' : 'OFF',
        loginId: localStorage.getItem('loginId') || '',
      })
    );
    await Promise.all(updatePromises);

    // ì„±ê³µ ì‹œ cars ë°°ì—´ ì—…ë°ì´íŠ¸
    setCars(prev =>
      prev.map(car => ({
        ...car,
        status: newState ? 'ìš´í–‰' : 'ëŒ€ê¸°',
        powerStatus: newState ? 'ON' : 'OFF',
      }))
    );
  } catch (error) {
    // ì—ëŸ¬ ì‹œ ë¡¤ë°±
    // ...
  }
};
```

---

## ì°¨ëŸ‰ ë²ˆí˜¸ ê²€ìƒ‰

```typescript
// src/app/emulator/page.tsx:48-77
const handleNumberSearch = async () => {
  if (!carNumber.trim()) {
    setError('ì°¨ëŸ‰ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  const searchParams: CarSearchParams = {
    carNumber: carNumber.trim(),
  };

  const result = await CarService.searchCars(searchParams, 1, 500);
  setCars(result.content);

  // ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•œ ìŠ¤ìœ„ì¹˜ ìƒíƒœ ì„¤ì •
  const searchStates: Record<string, boolean> = {};
  result.content.forEach(car => {
    searchStates[car.carNumber] = car.status === 'ìš´í–‰';
  });
  setSwitchStates(searchStates);
};
```

---

## UI ì»´í¬ë„ŒíŠ¸

### Switch ì»´í¬ë„ŒíŠ¸

```tsx
<Switch
  id={`powerStatus-${car.carNumber}`}
  checked={switchStates[car.carNumber] || false}
  onCheckedChange={checked => handleSwitchChange(car.carNumber, checked)}
/>
```

### ì „ì²´ ì œì–´ Switch

```tsx
<Switch
  id="toggleAll"
  checked={Object.values(switchStates).every(state => state)}
  onCheckedChange={handleToggleAll}
/>
<Label>
  {Object.values(switchStates).every(state => state) ? 'ì „ì²´ ON' : 'ì „ì²´ OFF'}
</Label>
```

---

## í…Œì´ë¸” êµ¬ì¡°

```tsx
<Table>
  <TableHeader>
    <TableRow>
      <TableHead>ì°¨ëŸ‰ë²ˆí˜¸</TableHead>
      <TableHead>ìƒíƒœ</TableHead>
      <TableHead>ON/OFF</TableHead>
    </TableRow>
  </TableHeader>
  <TableBody>
    {cars.map(car => (
      <TableRow key={car.carNumber}>
        <TableCell>{car.carNumber}</TableCell>
        <TableCell>{car.status}</TableCell>
        <TableCell>
          <Switch ... />
        </TableCell>
      </TableRow>
    ))}
  </TableBody>
</Table>
```

---

## ìŠ¤íƒ€ì¼

**íŒŒì¼:** [src/app/emulator/emulator.module.css](../src/app/emulator/emulator.module.css)

ì£¼ìš” í´ë˜ìŠ¤:
- `.emulatorTable` - í…Œì´ë¸” ìŠ¤íƒ€ì¼
- `.tableHeader` - í—¤ë” ìŠ¤íƒ€ì¼
- `.tableCell` - ì…€ ìŠ¤íƒ€ì¼

---

## ì—ë®¬ë ˆì´í„° ì„œë²„

ì—ë®¬ë ˆì´í„° ì „ìš© ë°±ì—”ë“œ ì„œë²„ ì‚¬ìš©:

```typescript
// src/lib/api.ts
const EMULATOR_API_BASE_URL = 'http://3.37.93.107:8081/api';
export const emulatorApi = createApiInstance(EMULATOR_API_BASE_URL);
```

---

## ë‚™ê´€ì  ì—…ë°ì´íŠ¸ íŒ¨í„´

1. UI ë¨¼ì € ì—…ë°ì´íŠ¸ (ì‚¬ìš©ì í”¼ë“œë°±)
2. API í˜¸ì¶œ
3. ì„±ê³µ ì‹œ ë°ì´í„° ë™ê¸°í™”
4. ì‹¤íŒ¨ ì‹œ UI ë¡¤ë°±

```typescript
// 1. UI ì—…ë°ì´íŠ¸
setSwitchStates(prev => ({ ...prev, [carNumber]: checked }));

try {
  // 2. API í˜¸ì¶œ
  await EmulService.powerCar(...);
  // 3. ë°ì´í„° ë™ê¸°í™”
  setCars(prev => prev.map(...));
} catch (error) {
  // 4. ë¡¤ë°±
  setSwitchStates(prev => ({ ...prev, [carNumber]: !checked }));
}
```

---

## ê´€ë ¨ ë¬¸ì„œ

- [API-Reference](API-Reference) - ì—ë®¬ë ˆì´í„° API
- [Architecture](Architecture) - ì—ë®¬ë ˆì´í„° ì„œë²„ êµ¬ì¡°
