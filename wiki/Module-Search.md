# Module: Search (ì°¨ëŸ‰ ê²€ìƒ‰)

> ì°¨ëŸ‰ ëª©ë¡ ì¡°íšŒ, ê²€ìƒ‰, í•„í„°ë§ ë° ë“±ë¡ ê¸°ëŠ¥

---

## ê°œìš”

ì°¨ëŸ‰ ê²€ìƒ‰ í˜ì´ì§€ëŠ” ì „ì²´ ì°¨ëŸ‰ ëª©ë¡ì„ ì¡°íšŒí•˜ê³  ë‹¤ì–‘í•œ ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

**ê²½ë¡œ:** `/search`
**íŒŒì¼:** [src/app/search/page.tsx](../src/app/search/page.tsx)

---

## ìŠ¤í¬ë¦°ìƒ·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [TopBar]  2 the Core                    [AccountMenu]  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [ì°¨ëŸ‰ ê²€ìƒ‰] [ì£¼í–‰ ê¸°ë¡] [ë°ì´í„° ë¶„ì„] [ì—ë®¬ë ˆì´í„°]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” ì°¨ëŸ‰ë²ˆí˜¸ ê²€ìƒ‰          [ê²€ìƒ‰]                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ì°¨ëŸ‰ëª…: [          ]  ìƒíƒœ: [ìš´í–‰ â–¼]  [ê²€ìƒ‰]        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 12ê°€ 1234 | í˜„ëŒ€ ì•„ë°˜ë–¼ | ğŸŸ¢ ìš´í–‰     [ìƒì„¸] [ì‚­ì œ] â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ 23ë‚˜ 2345 | ê¸°ì•„ K5     | ğŸŸ¡ ëŒ€ê¸°     [ìƒì„¸] [ì‚­ì œ] â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ 34ë‹¤ 3456 | í˜„ëŒ€ ì†Œë‚˜íƒ€ | ğŸ”´ ìˆ˜ë¦¬     [ìƒì„¸] [ì‚­ì œ] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    [+]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```mermaid
graph TD
    SearchPage["SearchPage"]
    SearchPage --> SearchBox

    SearchBox --> NumberSearchBox
    SearchBox --> BrandFilterBox
    SearchBox --> ListBox["ListBox x N"]
    SearchBox --> CarRegisterModal

    BrandFilterBox --> Dropdown
    BrandFilterBox --> StatusSelect

    ListBox --> IconButton
```

---

## ì£¼ìš” ê¸°ëŠ¥

### 1. ì°¨ëŸ‰ ë²ˆí˜¸ ê²€ìƒ‰

ì°¨ëŸ‰ ë²ˆí˜¸ë¡œ ì§ì ‘ ê²€ìƒ‰í•©ë‹ˆë‹¤.

```typescript
// src/components/search-box/search-box.tsx:93-142
const handleNumberSearch = async () => {
  const searchParams: CarSearchParams = {
    carNumber: carNumber.trim(),
    status: status,
    page: 1,
    offset: 10,
  };
  const result = await CarService.searchCars(searchParams);
  setCars(result.content);
};
```

### 2. í•„í„° ê²€ìƒ‰

ë¸Œëœë“œ/ëª¨ë¸ëª…ê³¼ ìƒíƒœë¡œ í•„í„°ë§í•©ë‹ˆë‹¤.

| í•„í„° | íƒ€ì… | ì˜ˆì‹œ |
|------|------|------|
| ì°¨ëŸ‰ëª… | `string` | "í˜„ëŒ€ ì•„ë°˜ë–¼", "ê¸°ì•„", "ì†Œë‚˜íƒ€" |
| ìƒíƒœ | `'ìš´í–‰' \| 'ëŒ€ê¸°' \| 'ìˆ˜ë¦¬'` | ìš´í–‰ |

### 3. ë¬´í•œ ìŠ¤í¬ë¡¤

`useObserver` í›…ì„ ì‚¬ìš©í•œ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„.

```typescript
// src/components/search-box/search-box.tsx:35-64
useEffect(() => {
  if (page === 1 || !hasNextPage) return;

  const loadMoreCars = async () => {
    const result = await CarService.searchCars(currentSearchParams, page, 10);
    setCars(prevCars => [...prevCars, ...result.content]);
    setHasNextPage(result.content.length === 10);
  };

  loadMoreCars();
}, [page, currentSearchParams, hasNextPage]);
```

### 4. ì°¨ëŸ‰ ë“±ë¡

í”Œë¡œíŒ… ë²„íŠ¼(+)ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì°¨ëŸ‰ì„ ë“±ë¡í•©ë‹ˆë‹¤.

---

## ìƒíƒœ ê´€ë¦¬

### ë¡œì»¬ ìƒíƒœ

```typescript
// src/components/search-box/search-box.tsx:10-28
const [cars, setCars] = useState<Car[]>([]);
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);

// ê²€ìƒ‰ ì¡°ê±´
const [carNumber, setCarNumber] = useState('');
const [brandModel, setBrandModel] = useState('');
const [status, setStatus] = useState('ìš´í–‰');

// ëª¨ë‹¬
const [isModalOpen, setIsModalOpen] = useState(false);

// ë¬´í•œ ìŠ¤í¬ë¡¤
const { page, setPage, isFetching, setIsFetching, setLastIntersecting } = useObserver();
const [hasNextPage, setHasNextPage] = useState(true);
const [currentSearchParams, setCurrentSearchParams] = useState<CarSearchParams | null>(null);
```

---

## ë°ì´í„° íë¦„

```mermaid
sequenceDiagram
    participant User
    participant SearchBox
    participant CarService
    participant API

    Note over SearchBox: í˜ì´ì§€ ë§ˆìš´íŠ¸
    SearchBox->>CarService: searchCars({ status: 'ìš´í–‰' })
    CarService->>API: GET /cars/search
    API-->>SearchBox: ì°¨ëŸ‰ ëª©ë¡

    User->>SearchBox: ê²€ìƒ‰ ì¡°ê±´ ì…ë ¥ + ê²€ìƒ‰ ë²„íŠ¼
    SearchBox->>CarService: searchCars(params)
    API-->>SearchBox: í•„í„°ë§ëœ ê²°ê³¼

    User->>SearchBox: ìŠ¤í¬ë¡¤ (í•˜ë‹¨ ë„ë‹¬)
    SearchBox->>CarService: searchCars(params, page + 1)
    API-->>SearchBox: ì¶”ê°€ ë°ì´í„°
    SearchBox->>SearchBox: cars = [...prev, ...new]
```

---

## ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### NumberSearchBox

**íŒŒì¼:** [src/components/search-box/number-search-box.tsx](../src/components/search-box/number-search-box.tsx)

```typescript
interface NumberSearchBoxProps {
  value: string;
  onChange: (value: string) => void;
  onSearch: () => void;
}
```

### BrandFilterBox (FilterBox)

**íŒŒì¼:** [src/components/search-box/filter-box.tsx](../src/components/search-box/filter-box.tsx)

```typescript
interface BrandFilterBoxProps {
  brandModel: string;
  setBrandModel: (value: string) => void;
  status: string;
  setStatus: (value: string) => void;
  onSearch: () => void;
}
```

### ListBox

**íŒŒì¼:** [src/components/search-box/list-box/list-box.tsx](../src/components/search-box/list-box/list-box.tsx)

```typescript
interface ListBoxProps {
  carNumber: string;
  brand: string;
  model: string;
  status: 'ìš´í–‰' | 'ëŒ€ê¸°' | 'ìˆ˜ë¦¬';
  onDelete: (carNumber: string) => void;
  ref?: React.Ref<HTMLDivElement>;
}
```

**ê¸°ëŠ¥:**
- ì°¨ëŸ‰ ì •ë³´ í‘œì‹œ
- ìƒì„¸ í˜ì´ì§€ ì´ë™ (`/detail?carNumber=...`)
- ì°¨ëŸ‰ ì‚­ì œ

### CarRegisterModal

**íŒŒì¼:** [src/components/search-box/car-register-modal.tsx](../src/components/search-box/car-register-modal.tsx)

ìƒˆ ì°¨ëŸ‰ ë“±ë¡ ëª¨ë‹¬ í¼.

---

## API í˜¸ì¶œ

### ì´ˆê¸° ë¡œë“œ

```typescript
// src/components/search-box/search-box.tsx:66-90
const loadInitialCars = async () => {
  const searchParams: CarSearchParams = {
    status: status,  // ê¸°ë³¸ê°’: 'ìš´í–‰'
    page: 1,
    offset: 10,
  };
  const carData = await CarService.searchCars(searchParams);
  setCars(carData.content);
};
```

### ê²€ìƒ‰

```typescript
// API: GET /cars/search
const result = await CarService.searchCars({
  carNumber: '12ê°€',      // ì˜µì…˜
  brand: 'í˜„ëŒ€',          // ì˜µì…˜
  model: 'ì•„ë°˜ë–¼',        // ì˜µì…˜
  status: 'ìš´í–‰',         // ì˜µì…˜
  twoParam: true,         // ë¸Œëœë“œ+ëª¨ë¸ ëª¨ë‘ ìˆì„ ë•Œ
  page: 1,
  offset: 10,
});
```

### ì‚­ì œ

```typescript
// src/components/search-box/list-box/list-box.tsx
await CarService.deleteCar(carNumber);
```

---

## ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì²˜ë¦¬

ë¸Œëœë“œì™€ ëª¨ë¸ ë¶„ë¦¬ ë¡œì§:

```typescript
// src/components/search-box/search-box.tsx:99-123
if (brandModel.trim()) {
  const parts = brandModel.trim().split(/\s+/);
  const brand = parts[0] || '';
  const model = parts.slice(1).join(' ') || '';

  if (brand && model) {
    searchParams.brand = brand;
    searchParams.model = model;
    searchParams.twoParam = true;
  } else if (brand) {
    searchParams.brand = brand;
    searchParams.twoParam = false;
  }
}
```

| ì…ë ¥ | brand | model | twoParam |
|------|-------|-------|----------|
| "í˜„ëŒ€ ì•„ë°˜ë–¼" | "í˜„ëŒ€" | "ì•„ë°˜ë–¼" | true |
| "í˜„ëŒ€" | "í˜„ëŒ€" | - | false |
| "ì•„ë°˜ë–¼" | "ì•„ë°˜ë–¼" | - | false |

---

## ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„

### useObserver í›…

**íŒŒì¼:** [src/hooks/use-intersection-observer.ts](../src/hooks/use-intersection-observer.ts)

```typescript
const { page, setPage, isFetching, setIsFetching, setLastIntersecting } = useObserver();
```

### ë§ˆì§€ë§‰ ì•„ì´í…œì— ref ì—°ê²°

```tsx
// src/components/search-box/search-box.tsx:277-291
{cars.map((car, idx) => (
  <ListBox
    key={`${car.carNumber}-${idx}`}
    {...car}
    ref={
      idx === cars.length - 1 && hasNextPage
        ? setLastIntersecting
        : null
    }
  />
))}
```

---

## ìŠ¤íƒ€ì¼

- [src/components/search-box/floating.module.css](../src/components/search-box/floating.module.css) - í”Œë¡œíŒ… ë²„íŠ¼
- [src/components/search-box/list-box/list-box.module.css](../src/components/search-box/list-box/list-box.module.css) - ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ
- [src/components/search-box/search-filter.module.css](../src/components/search-box/search-filter.module.css) - í•„í„° ë°•ìŠ¤

---

## ê´€ë ¨ ë¬¸ì„œ

- [Module-Detail](Module-Detail) - ì°¨ëŸ‰ ìƒì„¸ í˜ì´ì§€
- [API-Reference](API-Reference) - ì°¨ëŸ‰ API
- [Data-Flow](Data-Flow) - ë°ì´í„° íë¦„
